

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>1. Introduction &mdash; CDEPS main documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="CDEPS main documentation" href="index.html"/>
        <link rel="next" title="2. Input Streams" href="streams.html"/>
        <link rel="prev" title="CDEPS documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> CDEPS
          

          
          </a>

          
            
            
              <div class="version">
                
                  <div class="version-dropdown">
                    <select class="version-list" id="version-list">
                      <option value=''>main</option>
                      
                        
                      
                        
                          <option value="">[placeholder]</option>
                        
                      
                    </select>
                  </div>
                
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Introduction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">1.1. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#code-tree">1.2. Code Tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="#design">1.3. Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cdeps-and-cime-control-system-ccs">1.4. CDEPS and CIME Control System (CCS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#nuopc-cap">1.5. NUOPC Cap</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#initialization-phases">1.5.1. Initialization phases</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-phase">1.5.2. Run phase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#finalization-phase">1.5.3. Finalization phase</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integration-clock">1.5.4. Integration clock</a></li>
<li class="toctree-l3"><a class="reference internal" href="#grid-type-decomposition-mapping-to-internal-grid">1.5.5. Grid type, decomposition, mapping to internal grid</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="streams.html">2. Input Streams</a></li>
<li class="toctree-l1"><a class="reference internal" href="design_details.html">3. Design Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="datm.html">4. Data Atmosphere (DATM)</a></li>
<li class="toctree-l1"><a class="reference internal" href="docn.html">5. Data Ocean (DOCN)</a></li>
<li class="toctree-l1"><a class="reference internal" href="dice.html">6. Data Ice (DICE)</a></li>
<li class="toctree-l1"><a class="reference internal" href="dlnd.html">7. Data Land (DLND)</a></li>
<li class="toctree-l1"><a class="reference internal" href="drof.html">8. Data Runoff (DROF)</a></li>
<li class="toctree-l1"><a class="reference internal" href="dwav.html">9. Data Wave (DWAV)</a></li>
<li class="toctree-l1"><a class="reference internal" href="extending.html">10. Extending CDEPS</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CDEPS</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li><span class="section-number">1. </span>Introduction</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/introduction.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="introduction">
<span id="data-model-introduction"></span><h1><span class="section-number">1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h1>
<section id="overview">
<h2><span class="section-number">1.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">¶</a></h2>
<p>The Community Data Models for Earth Predictive Systems (CDEPS)
contains a set of NUOPC-compliant data components along with
ESMF-based “stream” code that enables new capabilities in selectively
removing feedbacks in coupled model systems.  The CDEPS data
models perform the basic function of reading external data files,
modifying those data, and then sending the data back to the CMEPS
mediator.  The fields sent to the mediator are the same as those that
would be sent by an active component.  This takes advantage of the
fact that the mediator and other CMEPS-compliant model components have
no fundamental knowledge of whether another component is fully active
or just a data component.</p>
<p>CDEPS is completely ESMF based. As a result, regridding between the
stream resolution and the model resolution can occur at run time for
any regridding option that ESMF supports. In addition, the PIO library
is used so that all of the stream data is read in parallel by the
CDEPS stream code.</p>
<p>The CDEPS data models typically read gridded data from a variety of sources
including observations, reanalysis products or output data from a
previous model simulation.  Out of the box, they often provide a few
possible data sources and/or time periods that you can choose from
when setting up a case.</p>
<p>In some cases, data models have prognostic functionality, that is,
they also receive and use data sent by the mediator.  However, in most
cases, the data models are not running prognostically and have no need
to receive any data from the mediator.</p>
<p>The CIME data models have parallel capability and share significant
amounts of source code.  Methods for reading and interpolating data
have been established and can easily be reused: The data model calls
strdata (“stream data”) methods which then call stream methods.  The
stream methods are responsible for managing lists of input data files
and their time axes.  The information is then passed up to the strdata
methods where the data is read and interpolated in space and time.
The interpolated data is passed up to the data model where final
fields are derived, packed, and returned to the mediator.</p>
</section>
<section id="code-tree">
<h2><span class="section-number">1.2. </span>Code Tree<a class="headerlink" href="#code-tree" title="Permalink to this heading">¶</a></h2>
<p>CDEPS contains the following code tree:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Directory</p></th>
<th class="head"><p>Function</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>cime_config</p></td>
<td><p>CIME Case Control System</p></td>
</tr>
<tr class="row-odd"><td><p>cmake</p></td>
<td><p>Build (can be used with or without CIME)</p></td>
</tr>
<tr class="row-even"><td><p>datm</p></td>
<td><p>Data atmosphere component</p></td>
</tr>
<tr class="row-odd"><td><p>dice</p></td>
<td><p>Data sea-ice component</p></td>
</tr>
<tr class="row-even"><td><p>dlnd</p></td>
<td><p>Data land component</p></td>
</tr>
<tr class="row-odd"><td><p>docn</p></td>
<td><p>Data ocean component</p></td>
</tr>
<tr class="row-even"><td><p>drof</p></td>
<td><p>Data river component</p></td>
</tr>
<tr class="row-odd"><td><p>dwav</p></td>
<td><p>Data wave component</p></td>
</tr>
<tr class="row-even"><td><p>dshr</p></td>
<td><p>Shared NUOPC cap code</p></td>
</tr>
<tr class="row-odd"><td><p>share</p></td>
<td><p>Shared utility code</p></td>
</tr>
<tr class="row-even"><td><p>streams</p></td>
<td><p>Code to handle streams</p></td>
</tr>
<tr class="row-odd"><td><p>doc</p></td>
<td><p>Sphinx documentation source</p></td>
</tr>
</tbody>
</table>
</section>
<section id="design">
<h2><span class="section-number">1.3. </span>Design<a class="headerlink" href="#design" title="Permalink to this heading">¶</a></h2>
<p>Data models function by reading in different <code class="docutils literal notranslate"><span class="pre">streams</span></code> of input
data. A <code class="docutils literal notranslate"><span class="pre">stream</span></code> is defined as a set of data files containing a set
of fields, where all the fields are on the same stream mesh and have
the same time coordinates. Data models input falls into two
categories: stream-independent and stream-dependent data.</p>
<dl>
<dt><strong>stream-dependent-data</strong></dt><dd><p>Stream-dependent input is contained in the input XML file
<code class="docutils literal notranslate"><span class="pre">d{model_name}.streams.xml</span></code>, where <code class="docutils literal notranslate"><span class="pre">model_name</span></code> can be <code class="docutils literal notranslate"><span class="pre">atm</span></code>,
<code class="docutils literal notranslate"><span class="pre">ice</span></code>, <code class="docutils literal notranslate"><span class="pre">lnd</span></code>, <code class="docutils literal notranslate"><span class="pre">ocn</span></code>, <code class="docutils literal notranslate"><span class="pre">rof</span></code> or <code class="docutils literal notranslate"><span class="pre">wav</span></code>.  Multiple streams can
be specified in the this XML file (see <a class="reference internal" href="streams.html#input-streams"><span class="std std-ref">streams</span></a>).
In turn, each stream in the xml file can be associated with multiple
stream input files.  The data across all the stream input files must
all be on the same stream mesh and share the same time coordinates.</p>
<p>In this case, the input XML file is parsed by CDEPS using the
third-party <a class="reference external" href="https://github.com/andreww/fox">FoX library</a>.
In addition to the XML format, it is also possible to use
<a class="reference external" href="http://earthsystemmodeling.org/docs/nightly/develop/ESMF_refdoc/node6.html#SECTION06090000000000000000">ESMF config format</a>
to define stream dependent namelist options (see <a class="reference internal" href="streams.html#input-streams"><span class="std std-ref">streams</span></a>).
This option is mainly used by the NOAA’s <a class="reference external" href="https://ufs-weather-model.readthedocs.io/en/latest/">UFS Weather Model</a> while
XML format used by NCAR’s <a class="reference external" href="https://www.cesm.ucar.edu">CESM</a>.</p>
</dd>
<dt><strong>stream-independent-data</strong></dt><dd><p>Stream-independent input is contained in the input namelist file
file <code class="docutils literal notranslate"><span class="pre">d{model_name}_in</span></code>. This file specifies a data model mesh
file, a data model mask file along with other stream-independent
data model specific configuration variables. In addition, each
<code class="docutils literal notranslate"><span class="pre">d{model_name}_in</span></code> namelist file contains a namelist variable
<code class="docutils literal notranslate"><span class="pre">datamode</span></code> which specifies the additional operations that need to
be performed on the input streams to create the data model export
state.</p>
</dd>
</dl>
<p>Data models leverage the CDEPS stream code to spatially interpolate the
stream data to the model resolution and temporarlly interpolate the
data to the model time.  The CDEPS stream code carries this out as
follows:</p>
<ul class="simple">
<li><p>The two timestamps of input data that bracket the present model time are read first.
These are called the lower and upper bounds of data and will change as the model advances.</p></li>
<li><p>The lower and upper bound data are then spatially mapped to the
model grid based upon the in the <code class="docutils literal notranslate"><span class="pre">d{model_name}.streams[.xml]</span></code> node
<code class="docutils literal notranslate"><span class="pre">mapalgo</span></code>.  Spatial interpolation only occurs if the input data
grid and model grid are not identical, and this is determined in the
strdata module automatically.</p></li>
<li><p>Time interpolation is the final step and is done using a time
interpolation method specified in the <code class="docutils literal notranslate"><span class="pre">d{model_name}.streams[.xml]</span></code>
node <code class="docutils literal notranslate"><span class="pre">tintalgo</span></code>.</p></li>
<li><p>A final set of fields is then available to the data model on the
model grid and for the current model time.</p></li>
<li><p>Each data model component communicates with the NUOPC mediator and
exchanges fields on only the data model mesh.</p></li>
</ul>
</section>
<section id="cdeps-and-cime-control-system-ccs">
<h2><span class="section-number">1.4. </span>CDEPS and CIME Control System (CCS)<a class="headerlink" href="#cdeps-and-cime-control-system-ccs" title="Permalink to this heading">¶</a></h2>
<p>If the CDEPS data models are used in conjunction with the CIME Case Control System (CCS) then the following will also hold:
Each data model has an xml variable in <code class="docutils literal notranslate"><span class="pre">env_run.xml</span></code> that specifies the data model mode.
These are: <code class="docutils literal notranslate"><span class="pre">DATM_MODE</span></code>, <code class="docutils literal notranslate"><span class="pre">DICE_MODE</span></code>, <code class="docutils literal notranslate"><span class="pre">DLND_MODE</span></code>, <code class="docutils literal notranslate"><span class="pre">DOCN_MODE</span></code>, <code class="docutils literal notranslate"><span class="pre">DROF_MODE</span></code>, <code class="docutils literal notranslate"><span class="pre">DWAV_MODE</span></code>.
Each data model mode specifies the streams that are associated with that data model.</p>
<p>More details of the data model design are covered in <a class="reference internal" href="design_details.html#design-details"><span class="std std-ref">design details</span></a>.</p>
</section>
<section id="nuopc-cap">
<h2><span class="section-number">1.5. </span>NUOPC Cap<a class="headerlink" href="#nuopc-cap" title="Permalink to this heading">¶</a></h2>
<section id="initialization-phases">
<h3><span class="section-number">1.5.1. </span>Initialization phases<a class="headerlink" href="#initialization-phases" title="Permalink to this heading">¶</a></h3>
<p>The CDEPS data component has two initialization phases for each data model:
(1) advertise and, (2) realize phases. In the advertise phase, the data
component queries namelist files and specifies a data model mesh and mask
files along with other stream-independent data model specific configuration
variables. Then, the advertise phase initializes PIO for reading and writing
netCDF files under CDEPS. As a last step, the top level advertise phase calls
the stream specific one since advertised fields are changed based on used data
mode. This will allow CDEPS to specialize based on the selected data mode
and list of exported fields. In the realize phase, the data model
reads the stream definition file and runs the data component to prepare
initial data for other components.</p>
</section>
<section id="run-phase">
<h3><span class="section-number">1.5.2. </span>Run phase<a class="headerlink" href="#run-phase" title="Permalink to this heading">¶</a></h3>
<p>The CDEPS data component is designed to have a different run phase for each
data mode, which is controlled by a top-level data component specific NUOPC “cap”.
In the first advance step, the data model specific run phase initializes the
export fields that have a corresponding stream field. Then, initializes the
data mode specific stream and export field pointers. If it is required, the
data model also reads the restart files in this initial step. The spatial and
temporal interpolation is performed internally using ESMF provided spatial
interpolation types and custom temporal interpolation routines if the data
model and stream meshes are not identical. After interpolating (or transferring)
stream to data model mesh, the top-level advance routine calls data mode
specific routines, which are responsible to calculate added value fields
(i.e., wind speed from wind components) and convert units of the data
stream based on the convention used in CDEPS.</p>
</section>
<section id="finalization-phase">
<h3><span class="section-number">1.5.3. </span>Finalization phase<a class="headerlink" href="#finalization-phase" title="Permalink to this heading">¶</a></h3>
<p>The data model just returns a message that indicates the end of the main integration loop.</p>
</section>
<section id="integration-clock">
<h3><span class="section-number">1.5.4. </span>Integration clock<a class="headerlink" href="#integration-clock" title="Permalink to this heading">¶</a></h3>
<p>The CDEPS data component run time is set through the shared <code class="docutils literal notranslate"><span class="pre">dshr_set_runclock</span></code>
routine. In this case, the driver configuration dictates the model start and stop
times (through use of ESMF config file, <code class="docutils literal notranslate"><span class="pre">nuopc.runconfig</span></code>) and coupling interval to
call the data component through the use of ESMF/NUOPC run sequence (<code class="docutils literal notranslate"><span class="pre">nuopc.runseq</span></code>).
The <code class="docutils literal notranslate"><span class="pre">dshr_set_runclock</span></code> call also sets up ESMF alarms for restart and stop times
that are used internally in the model and create internal clock representations.</p>
</section>
<section id="grid-type-decomposition-mapping-to-internal-grid">
<h3><span class="section-number">1.5.5. </span>Grid type, decomposition, mapping to internal grid<a class="headerlink" href="#grid-type-decomposition-mapping-to-internal-grid" title="Permalink to this heading">¶</a></h3>
<p>As it mentioned previously, CDEPS includes two programming layers to support flexible
data components: (1) data model and (2) streams. In this design, the data model stays
on top and interacts with the other active model components or mediator. Unlike the
data models, streams do not directly interact with other components but are used by
the data models to create export states. In this case, the streams could have different
meshes but they are spatially mapped to data model mesh before passing to the other
components. This step also includes temporal interpolation to calculate the data
in a certain time and has ability to perform different temporal interpolation
types for each variable such as <code class="docutils literal notranslate"><span class="pre">coszen</span></code>, which scale the data according to the
cosine of the solar zenith angle and can be used to represent the diurnal
cycle for solar radiation. The decomposition of the data is handled by the ESMF.</p>
</section>
</section>
</section>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="streams.html" class="btn btn-neutral float-right" title="2. Input Streams" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="CDEPS documentation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, U.S. National Science Foundation.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
     
<script>var version_json_loc = "../../versions.json";</script>


</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/pop_ver.js"></script>
    

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>